---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
  name: nodescans.clamav.io
spec:
  group: clamav.io
  names:
    kind: NodeScan
    listKind: NodeScanList
    plural: nodescans
    shortNames:
    - ns
    - nodescan
    singular: nodescan
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.nodeName
      name: Node
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.filesScanned
      name: Scanned
      type: integer
    - jsonPath: .status.filesInfected
      name: Infected
      type: integer
    - jsonPath: .status.duration
      name: Duration
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: NodeScan is the Schema for the nodescans API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: NodeScanSpec defines the desired state of NodeScan
            properties:
              excludePatterns:
                description: ExcludePatterns are regex patterns for paths to exclude
                items:
                  type: string
                type: array
              fileTimeout:
                default: 300000
                description: FileTimeout in milliseconds for scanning each file
                format: int64
                type: integer
              maxConcurrent:
                default: 5
                description: MaxConcurrent files to scan in parallel
                format: int32
                maximum: 20
                minimum: 1
                type: integer
              maxFileSize:
                default: 104857600
                description: MaxFileSize in bytes - files larger than this will be
                  skipped
                format: int64
                type: integer
              nodeName:
                description: NodeName is the name of the node to scan
                minLength: 1
                type: string
              paths:
                description: |-
                  Paths to scan on the node
                  If not specified, uses paths from ScanPolicy or defaults
                items:
                  type: string
                type: array
              priority:
                default: medium
                description: |-
                  Priority of the scan (high, medium, low)
                  Affects scheduling and resource allocation
                enum:
                - high
                - medium
                - low
                type: string
              resources:
                description: Resources for the scan job
                properties:
                  claims:
                    description: |-
                      Claims lists the names of resources, defined in spec.resourceClaims,
                      that are used by this container.

                      This is an alpha field and requires enabling the
                      DynamicResourceAllocation feature gate.

                      This field is immutable. It can only be set for containers.
                    items:
                      description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                      properties:
                        name:
                          description: |-
                            Name must match the name of one entry in pod.spec.resourceClaims of
                            the Pod where this field is used. It makes that resource available
                            inside a container.
                          type: string
                      required:
                      - name
                      type: object
                    type: array
                    x-kubernetes-list-map-keys:
                    - name
                    x-kubernetes-list-type: map
                  limits:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Limits describes the maximum amount of compute resources allowed.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                  requests:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Requests describes the minimum amount of compute resources required.
                      If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                      otherwise to an implementation-defined value. Requests cannot exceed Limits.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                type: object
              scanPolicy:
                description: |-
                  ScanPolicy references a ScanPolicy to use for this scan
                  If not specified, default scan parameters will be used
                type: string
              ttlSecondsAfterFinished:
                default: 86400
                description: |-
                  TTLSecondsAfterFinished limits the lifetime of a Job that has finished
                  execution (either Complete or Failed). If this field is set,
                  ttlSecondsAfterFinished after the Job finishes, it is eligible to be
                  automatically deleted.
                format: int32
                type: integer
            required:
            - nodeName
            type: object
          status:
            description: NodeScanStatus defines the observed state of NodeScan
            properties:
              completionTime:
                description: CompletionTime of the scan
                format: date-time
                type: string
              conditions:
                description: Conditions represent the latest available observations
                  of the NodeScan's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              duration:
                description: Duration of the scan in seconds
                format: int64
                type: integer
              errorCount:
                description: ErrorCount is the number of errors encountered during
                  scan
                format: int64
                type: integer
              filesInfected:
                description: FilesInfected is the number of infected files found
                format: int64
                type: integer
              filesScanned:
                description: FilesScanned is the total number of files scanned
                format: int64
                type: integer
              filesSkipped:
                description: FilesSkipped is the number of files skipped
                format: int64
                type: integer
              infectedFiles:
                description: |-
                  InfectedFiles contains details of infected files
                  Limited to first 100 for performance
                items:
                  description: InfectedFile represents a file found to be infected
                    with malware
                  properties:
                    detectedAt:
                      description: DetectedAt is when the infection was detected
                      format: date-time
                      type: string
                    path:
                      description: Path to the infected file on the node
                      type: string
                    size:
                      description: Size of the infected file in bytes
                      format: int64
                      type: integer
                    viruses:
                      description: Viruses detected in the file
                      items:
                        type: string
                      type: array
                  required:
                  - path
                  - viruses
                  type: object
                type: array
              jobRef:
                description: JobRef is a reference to the created Job
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              lastTransitionTime:
                description: LastTransitionTime is the last time the phase transitioned
                format: date-time
                type: string
              phase:
                description: Phase of the scan
                enum:
                - Pending
                - Running
                - Completed
                - Failed
                type: string
              reportPath:
                description: ReportPath is the path to the detailed scan report on
                  the node
                type: string
              startTime:
                description: StartTime of the scan
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
