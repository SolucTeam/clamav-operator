---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
  name: scanpolicies.clamav.io
spec:
  group: clamav.io
  names:
    kind: ScanPolicy
    listKind: ScanPolicyList
    plural: scanpolicies
    shortNames:
    - sp
    - scanpolicy
    singular: scanpolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.paths
      name: Paths
      type: string
    - jsonPath: .spec.maxConcurrent
      name: MaxConcurrent
      type: integer
    - jsonPath: .status.usageCount
      name: UsageCount
      type: integer
    - jsonPath: .status.lastUsed
      name: LastUsed
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ScanPolicy is the Schema for the scanpolicies API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ScanPolicySpec defines the desired state of ScanPolicy
            properties:
              connectTimeout:
                default: 60000
                description: ConnectTimeout in milliseconds for connecting to ClamAV
                format: int64
                type: integer
              excludePatterns:
                description: ExcludePatterns are regex patterns for paths to exclude
                  from scanning
                items:
                  type: string
                type: array
              fileTimeout:
                default: 300000
                description: FileTimeout in milliseconds for scanning each file
                format: int64
                type: integer
              maxConcurrent:
                default: 5
                description: MaxConcurrent files to scan in parallel
                format: int32
                maximum: 20
                minimum: 1
                type: integer
              maxFileSize:
                default: 104857600
                description: MaxFileSize in bytes - files larger than this will be
                  skipped
                format: int64
                type: integer
              notifications:
                description: Notifications configuration
                properties:
                  email:
                    description: Email notification settings
                    properties:
                      enabled:
                        description: Enabled indicates if email notifications are
                          enabled
                        type: boolean
                      from:
                        description: From is the sender email address
                        type: string
                      onlyOnInfection:
                        default: true
                        description: OnlyOnInfection sends emails only when malware
                          is detected
                        type: boolean
                      recipients:
                        description: Recipients is the list of recipient email addresses
                        items:
                          type: string
                        minItems: 1
                        type: array
                      smtpAuthSecretRef:
                        description: |-
                          SMTPAuthSecretRef references a Secret containing SMTP credentials
                          Expected keys: username, password
                        properties:
                          name:
                            description: name is unique within a namespace to reference
                              a secret resource.
                            type: string
                          namespace:
                            description: namespace defines the space within which
                              the secret name must be unique.
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      smtpServer:
                        description: SMTPServer is the SMTP server address (host:port)
                        type: string
                    required:
                    - enabled
                    - from
                    - recipients
                    - smtpServer
                    type: object
                  slack:
                    description: Slack notification settings
                    properties:
                      channel:
                        description: Channel to send notifications to
                        type: string
                      enabled:
                        description: Enabled indicates if Slack notifications are
                          enabled
                        type: boolean
                      onlyOnInfection:
                        default: true
                        description: OnlyOnInfection sends notifications only when
                          malware is detected
                        type: boolean
                      webhookSecretRef:
                        description: WebhookSecretRef references a Secret containing
                          the webhook URL
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            description: |-
                              Name of the referent.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                      webhookURL:
                        description: |-
                          WebhookURL is the Slack webhook URL
                          Should be stored in a Secret and referenced
                        type: string
                    required:
                    - enabled
                    type: object
                  webhook:
                    description: Webhook notification settings
                    properties:
                      headers:
                        additionalProperties:
                          type: string
                        description: Headers to include in webhook requests
                        type: object
                      onlyOnInfection:
                        default: true
                        description: OnlyOnInfection sends webhooks only when malware
                          is detected
                        type: boolean
                      secretRef:
                        description: SecretRef references a Secret containing auth
                          headers
                        properties:
                          name:
                            description: name is unique within a namespace to reference
                              a secret resource.
                            type: string
                          namespace:
                            description: namespace defines the space within which
                              the secret name must be unique.
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                      url:
                        description: URL to send webhook notifications to
                        type: string
                    required:
                    - url
                    type: object
                type: object
              paths:
                description: Paths to scan on each node
                items:
                  type: string
                minItems: 1
                type: array
              quarantine:
                description: Quarantine configuration
                properties:
                  action:
                    default: alert-only
                    description: Action to take on infected files
                    enum:
                    - move
                    - delete
                    - alert-only
                    type: string
                  enabled:
                    description: Enabled indicates if quarantine is enabled
                    type: boolean
                  notifyAdmin:
                    default: true
                    description: NotifyAdmin sends notification when files are quarantined
                    type: boolean
                  quarantineDir:
                    description: |-
                      QuarantineDir is the directory to move infected files to
                      Only used when Action is "move"
                    type: string
                required:
                - action
                - enabled
                type: object
              resources:
                description: Resources for scan jobs
                properties:
                  claims:
                    description: |-
                      Claims lists the names of resources, defined in spec.resourceClaims,
                      that are used by this container.

                      This is an alpha field and requires enabling the
                      DynamicResourceAllocation feature gate.

                      This field is immutable. It can only be set for containers.
                    items:
                      description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                      properties:
                        name:
                          description: |-
                            Name must match the name of one entry in pod.spec.resourceClaims of
                            the Pod where this field is used. It makes that resource available
                            inside a container.
                          type: string
                      required:
                      - name
                      type: object
                    type: array
                    x-kubernetes-list-map-keys:
                    - name
                    x-kubernetes-list-type: map
                  limits:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Limits describes the maximum amount of compute resources allowed.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                  requests:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: |-
                      Requests describes the minimum amount of compute resources required.
                      If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                      otherwise to an implementation-defined value. Requests cannot exceed Limits.
                      More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                    type: object
                type: object
            required:
            - paths
            type: object
          status:
            description: ScanPolicyStatus defines the observed state of ScanPolicy
            properties:
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastUsed:
                description: LastUsed is the last time this policy was used for a
                  scan
                format: date-time
                type: string
              usageCount:
                description: UsageCount is how many times this policy has been used
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
